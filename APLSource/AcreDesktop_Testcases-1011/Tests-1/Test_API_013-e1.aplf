 R←Test_API_013(stopFlag batchFlag);⎕TRAP;F;path;result;buff
⍝ Exercise the API function `Changefile`.
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')

 R←∆Failed

 F←##.FilesAndDirs
 #.⎕SHADOW'TEMP'
 'TEMP'#.⎕NS''
 #.TEMP.Foo←{42}

 path←{_←F.DeleteFile ⍵ ⋄ ¯4↓⍵}F.GetTempFilename''
 result←∆RunUcmd'CreateProject "',path,'" #.TEMP -keephistory=on'

 buff←⎕SE.acre.Changefile'#.TEMP.Foo'
 →GoToTidyUp 0=≢buff
 →GoToTidyUp'/Foo.aplf.change'{⍺≢(-⍴,⍺)↑⍵}⊃buff

 R←∆OK

∆TidyUp:
 :Trap 0 ⋄ {}F.RmDir path ⋄ :EndTrap
 ∆RunUcmd'Close #.TEMP'
⍝Done
